# 01 项目目标

## 1. 要解决的问题

1. 插件安装/更新可能引入依赖冲突，直接污染生产环境。
2. 依赖变化来源不清晰，难以定位“哪次操作导致问题”。
3. 插件卸载后依赖残留，环境逐步失控。
4. 失败后缺乏可审计、可约束的恢复手段。

## 2. 项目目标

1. 可复现：本地 `pyproject.toml + uv.lock` 可重建 prod 依赖环境。
2. 可审计：事务与操作有结构化记录（tx + op）。
3. 可恢复：`promote/remove` 失败自动恢复 pre-op，成功操作可 `undo`。
4. 可治理：核心包影响需要显式批准。

## 3. 设计原则

1. 真相本地化：依赖真相是本地文件，不依赖 Git 跟踪。
2. 模板可分发：仓库只跟踪 `*.template`/`*.example` 作为初始化与契约说明。
3. 状态本地化：插件注册、操作备份、日志均为本地状态，不进入 Git。
4. 失败优先恢复：关键流程失败先恢复 pre-op，再报告错误。
5. 可撤销受约束：`undo` 必须通过哈希一致性校验。

## 4. 成功标准

1. `tx run -> (resolve) -> tx promote` 流程稳定可重复。
2. `node remove` 能按 group 权威准确执行依赖 GC。
3. `undo <op_id>` 能撤销指定成功操作，并阻断漂移状态误撤销。
